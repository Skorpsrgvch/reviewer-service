# Reviewer Service ‚Äî –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≤—å—é–µ—Ä–æ–≤ –Ω–∞ Pull Request'—ã

–≠—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≤—å—é–µ—Ä–æ–≤ –Ω–∞ Pull Request‚Äô—ã –∏–∑ –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ—Ä–∞, –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≤—å—é–≤–µ—Ä–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ PR‚Äô–æ–≤, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Go + PostgreSQL, —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HTTP API, –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `docker-compose`.

---

## üß© –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- –Ø–∑—ã–∫: **Go 1.23**
- –ë–î: **PostgreSQL**
- –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫: **Gin**
- –ú–∏–≥—Ä–∞—Ü–∏–∏: **golang-migrate**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è: **Docker + docker-compose**

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- PowerShell –∏–ª–∏ bash (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/—Ç–≤–æ–π-–Ω–∏–∫/reviewer-service.git
cd reviewer-service

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
docker-compose up --build -d

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8080/stats
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"assignments":{}}


üìú API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization: Bearer admin –¥–ª—è –∏–∑–º–µ–Ω—è—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

POST
/team/add
–°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
GET
/team/get?team_name=...
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
POST
/users/setIsActive
–ò–∑–º–µ–Ω–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET
/users/getReview?user_id=...
–ü–æ–ª—É—á–∏—Ç—å PR, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
POST
/pullrequest/create
–°–æ–∑–¥–∞—Ç—å PR (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–µ–≤—å—é–µ—Ä–æ–≤)
POST
/pullrequest/merge
–°–ª–∏—Ç—å PR (–ø–æ—Å–ª–µ merge ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã)
POST
/pullrequest/reassign
–ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –æ–¥–Ω–æ–≥–æ —Ä–µ–≤—å—é–µ—Ä–∞
GET
/stats
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º

üìä –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

‚úÖ 50 PR –∑–∞ 0.37 —Å–µ–∫ ‚Üí ~135 RPS
‚úÖ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 19 –º—Å (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ: ‚â§ 300 –º—Å)
‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª PR (create ‚Üí reassign ‚Üí merge): 19 –º—Å
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ /stats –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ load-test-results.txt .

‚ùì –í–æ–∑–Ω–∏–∫—à–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Ä–µ—à–µ–Ω–∏—è
1. –ö–∞–∫–æ–π –ø—É—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ API?
–í OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –±—ã–ª–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞, –ø–æ—ç—Ç–æ–º—É —è –≤—ã–±—Ä–∞–ª –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, /pullrequest/create –≤–º–µ—Å—Ç–æ /pullRequest/create), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é.
–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ REST API.
2. –ö–∞–∫ –≤—ã–±–∏—Ä–∞—Ç—å —Ä–µ–≤—å—é–µ—Ä–æ–≤?
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR ‚Äî –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –¥–æ 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ—Ä–∞ (–∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –∞–≤—Ç–æ—Ä–∞) –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
–ü—Ä–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–µ–≤—å—é–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ –µ–≥–æ –∫–æ–º–∞–Ω–¥—ã (–Ω–µ –∞–≤—Ç–æ—Ä–∞, –Ω–µ —É–∂–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ).
3. –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ—à–∏–±–∫–∞–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏?
–ï—Å–ª–∏ –Ω–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "no active replacement candidate in team".
–ï—Å–ª–∏ PR —É–∂–µ —Å–ª–∏—Ç ‚Äî "cannot reassign on merged PR".
4. –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å merge?
–ï—Å–ª–∏ PR —É–∂–µ –≤ —Å—Ç–∞—Ç—É—Å–µ MERGED, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ merge –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–∫–∏.
üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
–û—Ç–∫—Ä–æ–π Postman –∏–ª–∏ curl
–°–æ–∑–¥–∞–π –∫–æ–º–∞–Ω–¥—É:
json


1
2
3
4
5
6
7
8
9
‚åÑ
‚åÑ
POST http://localhost:8080/team/add
{
  "team_name": "backend",
  "members": [
    { "user_id": "u1", "username": "author", "is_active": true },
    { "user_id": "u2", "username": "reviewer1", "is_active": true },
    { "user_id": "u3", "username": "reviewer2", "is_active": true }
  ]
}
–°–æ–∑–¥–∞–π PR:
json


1
2
3
4
5
6
‚åÑ
POST http://localhost:8080/pullrequest/create
{
  "pull_request_id": "pr-1",
  "pull_request_name": "Test PR",
  "author_id": "u1"
}
–ü–æ—Å–º–æ—Ç—Ä–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:


1
GET http://localhost:8080/stats
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞


1
2
3
4
5
6
7
8
9
10
11
12
13
14
cmd/
‚îú‚îÄ‚îÄ reviewer-service/
‚îÇ   ‚îî‚îÄ‚îÄ main.go           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
internal/
‚îú‚îÄ‚îÄ handler/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ HTTP
‚îú‚îÄ‚îÄ model/                # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ repository/postgres/  # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îú‚îÄ‚îÄ service/              # –õ–æ–≥–∏–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
migrations/               # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏
pkg/db/                   # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
docker-compose.yml        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
Dockerfile                # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
load-test.ps1             # –°–∫—Ä–∏–ø—Ç –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è graceful shutdown.
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.
–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å merge.